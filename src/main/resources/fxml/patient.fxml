<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.RadioButton?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<StackPane prefHeight="800.0" prefWidth="1280.0" xmlns="http://javafx.com/javafx/19" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.praktikumpbo.cardioexpert.PatientController">
    
    <HBox fx:id="rootBox" styleClass="root">
        
        <VBox minWidth="350.0" prefWidth="350.0" spacing="15" styleClass="card-pane">
            <padding><Insets bottom="30" left="30" right="80" top="30" /></padding>
            
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label styleClass="title-label" text="Konsultasi Pakar" />
                <Region HBox.hgrow="ALWAYS" />
                <Button fx:id="btnHistory" onAction="#handleShowHistory" styleClass="button-action" text="Riwayat Saya" />
                <Button fx:id="btnBackAdmin" onAction="#handleBackAdmin" styleClass="button-secondary" text="&lt; Admin" visible="false" />
            </HBox>
            
            <HBox spacing="10">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Jenis Kelamin" />
                    <HBox spacing="10">
                        <RadioButton fx:id="rbMale" selected="true" text="Pria">
                            <toggleGroup>
                                <ToggleGroup fx:id="genderGroup" />
                            </toggleGroup>
                        </RadioButton>
                        <RadioButton fx:id="rbFemale" text="Wanita" toggleGroup="$genderGroup" />
                    </HBox>
                </VBox>
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Umur (Tahun)" />
                    <TextField fx:id="inAge" promptText="cth. 45" />
                </VBox>
            </HBox>

            <HBox spacing="10">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Tinggi (cm)" />
                    <TextField fx:id="inHeight" promptText="cth. 170" />
                </VBox>
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Berat (kg)" />
                    <TextField fx:id="inWeight" promptText="cth. 70" />
                </VBox>
            </HBox>

            <HBox spacing="10">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Sistolik (Atas)" />
                    <TextField fx:id="inApHi" promptText="cth. 120" />
                </VBox>
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Diastolic (Bawah)" />
                    <TextField fx:id="inApLo" promptText="cth. 80" />
                </VBox>
            </HBox>

            <VBox spacing="5">
                <Label text="Tingkat Kolesterol" />
                <ComboBox fx:id="cbChol" maxWidth="Infinity" />
            </VBox>

            <VBox spacing="5">
                <Label text="Tingkat Gula Darah" />
                <ComboBox fx:id="cbGluc" maxWidth="Infinity" />
            </VBox>

            <HBox spacing="20">
                <CheckBox fx:id="chkSmoke" text="Perokok" />
                <CheckBox fx:id="chkAlco" text="Alkohol" />
                <CheckBox fx:id="chkActive" text="Aktif Fisik" />
            </HBox>

            <Button maxWidth="Infinity" onAction="#handleDiagnose" styleClass="button-primary" text="ANALISIS SISTEM PAKAR" />
            <Button fx:id="btnLogout" maxWidth="Infinity" onAction="#handleLogout" styleClass="button-secondary" text="Keluar" />
        </VBox>

        <VBox fx:id="resultBox" visible="false" HBox.hgrow="ALWAYS">
            <padding><Insets bottom="30" left="30" right="30" top="30" /></padding>
            <VBox spacing="15" styleClass="card-pane" VBox.vgrow="ALWAYS">
                <Label styleClass="title-label" text="Hasil Analisis Sistem Pakar" />
                
                <VBox alignment="CENTER" spacing="10" styleClass="result-box">
                    <Label style="-fx-font-size: 14px;" text="Prediksi Risiko:" />
                    <Label fx:id="lblResultLevel" style="-fx-font-size: 28px; -fx-font-weight: bold;" text="TIDAK DIKETAHUI" />
                </VBox>

                <Label style="-fx-font-weight: bold;" text="Penjelasan / Saran:" />
                <TextArea fx:id="txtRecommendation" editable="false" wrapText="true" VBox.vgrow="ALWAYS" />

                <HBox spacing="10">
                    <Button maxWidth="Infinity" onAction="#toggleDrawer" styleClass="button-secondary" text="Rincian Logika Sistem" HBox.hgrow="ALWAYS" />
                    <Button maxWidth="Infinity" onAction="#handleExportPdf" styleClass="button-primary" text="Ekspor PDF" HBox.hgrow="ALWAYS" />
                    <Button maxWidth="Infinity" onAction="#handleExportImage" styleClass="button-primary" text="Simpan Gambar" HBox.hgrow="ALWAYS" />
                </HBox>
            </VBox>
        </VBox>
    </HBox>

    <VBox fx:id="drawer" maxWidth="600" styleClass="drawer-pane" translateX="600" StackPane.alignment="CENTER_RIGHT">
        <Label style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 16px;" text="Detail Inferensi Sistem Pakar" />
        
        <TabPane style="-fx-background-color: white; -fx-background-radius: 5;" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">
            <Tab text="Log Perhitungan">
                <TextArea fx:id="txtLog" editable="false" style="-fx-font-family: 'Consolas';" />
            </Tab>
            <Tab text="Basis Aturan (Rule Base)">
                <TextArea fx:id="txtRulesDesc" editable="false" style="-fx-font-family: 'Consolas';" />
            </Tab>
            <Tab text="Visualisasi Fuzzy">
                <VBox>
                    <LineChart fx:id="chartFuzzyBP" createSymbols="false" legendVisible="true" title="Fungsi Keanggotaan: Tekanan Darah">
                        <xAxis><NumberAxis forceZeroInRange="false" label="mmHg" /></xAxis>
                        <yAxis><NumberAxis label="Derajat Keanggotaan (Mu)" upperBound="1.0" /></yAxis>
                    </LineChart>
                    <LineChart fx:id="chartFuzzyAge" createSymbols="false" legendVisible="true" title="Fungsi Keanggotaan: Umur">
                        <xAxis><NumberAxis forceZeroInRange="false" label="Tahun" /></xAxis>
                        <yAxis><NumberAxis label="Derajat Keanggotaan (Mu)" upperBound="1.0" /></yAxis>
                    </LineChart>
                    <LineChart fx:id="chartFuzzyWeight" createSymbols="false" legendVisible="true" title="Fungsi Keanggotaan: Berat Badan">
                        <xAxis><NumberAxis forceZeroInRange="false" label="Kg" /></xAxis>
                        <yAxis><NumberAxis label="Derajat Keanggotaan (Mu)" upperBound="1.0" /></yAxis>
                    </LineChart>
                </VBox>
            </Tab>
        </TabPane>
        
        <Button maxWidth="Infinity" onAction="#toggleDrawer" styleClass="button-secondary" text="Tutup Panel" />
    </VBox>

</StackPane>